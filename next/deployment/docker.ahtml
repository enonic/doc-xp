<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<title>Docker image</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article toc2 toc-right">
<div id="header">
<h1>Docker image</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#quick_start">Quick start</a></li>
<li><a href="#image_description">Image description</a>
<ul class="sectlevel2">
<li><a href="#goals">Goals</a></li>
<li><a href="#base_image">Base image</a></li>
<li><a href="#enforced_best_practices">Enforced best practices</a></li>
<li><a href="#preinstalled_tools">Preinstalled tools</a></li>
</ul>
</li>
<li><a href="#persisting_data">Persisting data</a>
<ul class="sectlevel2">
<li><a href="#important_directories">Important directories</a></li>
<li><a href="#other_directories">Other directories</a></li>
</ul>
</li>
<li><a href="#configuration">Configuration</a>
<ul class="sectlevel2">
<li><a href="#java-heap-memory">Heap memory</a></li>
<li><a href="#mounting_configuration">Mounting configuration</a></li>
<li><a href="#using_setenv_sh">Using setenv.sh</a></li>
<li><a href="#environmental_variables">Environmental variables</a></li>
</ul>
</li>
<li><a href="#exposed_ports">Exposed ports</a></li>
<li><a href="#useful_commands">Useful commands</a>
<ul class="sectlevel2">
<li><a href="#create_thread_dump">Create thread dump</a></li>
<li><a href="#create_heap_dump">Create heap dump</a></li>
<li><a href="#verify_snapshot_age">Verify snapshot age</a></li>
</ul>
</li>
<li><a href="#full_example">Full example</a>
<ul class="sectlevel2">
<li><a href="#setup">Setup</a></li>
<li><a href="#verifying">Verifying</a></li>
<li><a href="#running">Running</a></li>
<li><a href="#verify_deployment">Verify deployment</a></li>
<li><a href="#summary">Summary</a></li>
</ul>
</li>
<li><a href="#migration">Migrating from old image</a>
<ul class="sectlevel2">
<li><a href="#the_binary_wget_is_no_longer_present">The binary wget is no longer present</a></li>
<li><a href="#directory_xp_roothome_org_no_longer_present">Directory $XP_ROOT/home.org no longer present</a></li>
</ul>
</li>
<li><a href="#image_source_code">Image source code</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This section describes the official Enonic XP docker image as well how to configure and run it.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This applies to docker images for Enonic XP 7.3 and higher. For migration from versions 7.2 and lower read <a href="#migration">Migrating from old image</a> subsection.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="quick_start"><a class="link" href="#quick_start">Quick start</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you just want to try out the image, with no data persistence, you can run this command in your terminal.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Running this command requires you to have docker installed.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">docker run -it --rm -p 8080:8080 enonic/xp:7.14.4-ubuntu</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="image_description"><a class="link" href="#image_description">Image description</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="goals"><a class="link" href="#goals">Goals</a></h3>
<div class="paragraph">
<p>The goals of this docker image is to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>allow people to deploy Enonic XP easily</p>
</li>
<li>
<p>be able to run on different container orchestration frameworks</p>
</li>
<li>
<p>include the latest security patches for both the JVM and the container OS</p>
</li>
<li>
<p>be as light as possible</p>
</li>
<li>
<p>help with <em>day 2 operations</em>, like backups and JVM debugging</p>
</li>
<li>
<p>follow docker best practices</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="base_image"><a class="link" href="#base_image">Base image</a></h3>
<div class="paragraph">
<p>Every time the Enonic XP image is built it will be based off the latest <a href="https://hub.docker.com/r/enonic/graalvm">enonic/graalvm</a> docker image. This ensures the latest updates to the JVM and OS.</p>
</div>
</div>
<div class="sect2">
<h3 id="enforced_best_practices"><a class="link" href="#enforced_best_practices">Enforced best practices</a></h3>
<div class="dlist">
<dl>
<dt class="hdlist1">Entrypoint</dt>
<dd>
<p>The image uses a custom docker entrypoint that is designed to setup file permissions and step down from root user when running Enonic XP.</p>
</dd>
<dt class="hdlist1">Builder pattern</dt>
<dd>
<p>During the build process, all tools used for building the final image are dropped to make the image as light as possible.</p>
</dd>
<dt class="hdlist1">File permission</dt>
<dd>
<p>The image is designed to run on multiple orchestration frameworks and thus supports easily running Enonic XP as an arbitrary user.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="preinstalled_tools"><a class="link" href="#preinstalled_tools">Preinstalled tools</a></h3>
<div class="paragraph">
<p>To help with <em>day 2 operations</em>, the image comes with some useful preinstalled tools.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">app.sh</dt>
<dd>
<p>Script to add/remove jars from the Enonic XP deploy folder. An example usage would be <code>app.sh add &lt;PUBLIC_URL_TO_JAR&gt;</code>. Description and source <a href="https://github.com/enonic/docker-xp7/blob/master/bin/app.sh">here</a>.</p>
</dd>
<dt class="hdlist1">backups.sh</dt>
<dd>
<p>Convenient script for pre backup hooks to check the age of index snapshots created by the <a href="https://market.enonic.com/vendors/enonic/snapshotter">snapshotter</a> app. Description and source available <a href="https://github.com/enonic/docker-xp7/blob/master/bin/backup.sh">here</a>.</p>
</dd>
<dt class="hdlist1">dump.sh</dt>
<dd>
<p>Easily create JVM heap and thread dump. Description and source available <a href="https://github.com/enonic/docker-xp7/blob/master/bin/dump.sh">here</a>.</p>
</dd>
<dt class="hdlist1">jattach</dt>
<dd>
<p>A tiny tool to enable creating thread and heap dumps without the full JDK in the image. Description and source available <a href="https://github.com/apangin/jattach">here</a>.</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="persisting_data"><a class="link" href="#persisting_data">Persisting data</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are several directories storing various data that, depening on your deployment, should be persisted when containers are recreated.</p>
</div>
<div class="sect2">
<h3 id="important_directories"><a class="link" href="#important_directories">Important directories</a></h3>
<div class="paragraph">
<p>To create a deployment that is stable and easy to back up you should make the following directories persistent.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">$XP_HOME/config</dt>
<dd>
<p>Configuration files for Enonic XP.</p>
</dd>
<dt class="hdlist1">$XP_HOME/deploy</dt>
<dd>
<p>Apps deployed locally in this particluar container/node.</p>
</dd>
<dt class="hdlist1">$XP_HOME/repo/blob</dt>
<dd>
<p>Enonic XP blobstore.</p>
</dd>
<dt class="hdlist1">$XP_HOME/repo/index</dt>
<dd>
<p>Elasticsearch index.</p>
</dd>
<dt class="hdlist1">$XP_HOME/snapshots</dt>
<dd>
<p>Index snapshots created by the <a href="https://market.enonic.com/vendors/enonic/snapshotter">snapshotter</a> app.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="other_directories"><a class="link" href="#other_directories">Other directories</a></h3>
<div class="paragraph">
<p>These are directories that, depending on your application of Enonic XP and deployment policy, should maybe be persistent.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">$XP_HOME/data</dt>
<dd>
<p>Various extra data like thread/heap dumps.</p>
</dd>
<dt class="hdlist1">$XP_HOME/logs</dt>
<dd>
<p>Rotating log files from Enonic XP.</p>
</dd>
<dt class="hdlist1">$XP_HOME/work</dt>
<dd>
<p>Various cached files used by Enonic XP, e.g. resized images.</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration"><a class="link" href="#configuration">Configuration</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="java-heap-memory"><a class="link" href="#java-heap-memory">Heap memory</a></h3>
<div class="paragraph">
<p>Since this image uses a modern JVM, it will respect the container memory limits set by the docker daemon. There are some pitfalls though. Elasticsearch uses off-heap buffers, that can lead to the container running out of memory. For that reason, as a general rule, you should:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>set the heap size to <code>30%</code> of the available memory to the container</p>
</li>
<li>
<p>if the Enonic XP node is a pure master node, set the heap size to <code>75%</code> of the available memory to the container</p>
</li>
<li>
<p>set minimum and maximum heap size to the same value</p>
</li>
<li>
<p>never set heap size over <code>26 GB</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Parameters to achive this are described under the <a href="#xp-opts">Useful XP_OPTS parameters</a> section.</p>
</div>
</div>
<div class="sect2">
<h3 id="mounting_configuration"><a class="link" href="#mounting_configuration">Mounting configuration</a></h3>
<div class="paragraph">
<p>The image does contain the standard configuration that comes with all Enonic XP distribution. Depending on how you mount volumes into the container you might override that directory. Consider this command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">docker run -it --rm -v $(pwd)/host_config_dir:/enonic-xp/home/config enonic/xp:7.14.4-ubuntu</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will override the standard configuration directory with the host directory that might be empty, hence no configuration will be present for Enonic XP. This is probably not what you want. We recommend when you are mounting your configuration directory to the container, that you base it on the standard configuration directory provided in the docker image. To get a copy of the standard configuration run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">docker create --name=tmp enonic/xp:7.14.4-ubuntu
docker cp tmp:/enonic-xp/home/config config
docker rm tmp</code></pre>
</div>
</div>
<div class="paragraph">
<p>After running these commands you will have the standard configuration copied to your working directory.</p>
</div>
</div>
<div class="sect2">
<h3 id="using_setenv_sh"><a class="link" href="#using_setenv_sh">Using setenv.sh</a></h3>
<div class="paragraph">
<p>The image allows you to supply a custom <code>setenv.sh</code> script. It is sourced just before Enonic XP is started and can be used to setup the environment and run pre-scripts. To enable this, simply mount a script to <code>$XP_HOME/setenv.sh</code> in the container.</p>
</div>
</div>
<div class="sect2">
<h3 id="environmental_variables"><a class="link" href="#environmental_variables">Environmental variables</a></h3>
<div class="paragraph">
<p>This subsection lists some useful environmental variables to set while deploying this image.</p>
</div>
<div class="sect3">
<h4 id="variables_specific_to_this_image"><a class="link" href="#variables_specific_to_this_image">Variables specific to this image</a></h4>
<div class="dlist">
<dl>
<dt class="hdlist1">TAKE_FILE_OWNERSHIP</dt>
<dd>
<p>Set this boolean variable to <code>1</code> if you want the container to attempt to take file ownership of <code>$XP_HOME</code> directory during startup. This should not be used in general but is useful when migrating data between systems. It will only attemt this if the container is run as root. This cannot be set with <code>setenv.sh</code>. Defaults to <code>0</code>.</p>
</dd>
<dt class="hdlist1">XP_SNAPSHOT_MAX_AGE</dt>
<dd>
<p>Maximum age of index snapshots in minutes before the <code>backup.sh</code> script starts failing. This cannot be set with <code>setenv.sh</code>. Defaults to <code>1440</code> (24 hours).</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="java_opts_vs_xp_opts"><a class="link" href="#java_opts_vs_xp_opts">JAVA_OPTS vs XP_OPTS</a></h4>
<div class="paragraph">
<p>Although you can overwrite the default <code>JAVA_OPTS</code> it is not recommended. With every distribution the default parameters might be changed to improve performance and by overwriting them, you will not benefit from those changes. Instead we recommend using the environmental variable <code>XP_OPTS</code> to pass in your custom JVM parameters.</p>
</div>
</div>
<div class="sect3">
<h4 id="xp-opts"><a class="link" href="#xp-opts">Useful XP_OPTS parameters</a></h4>
<div class="paragraph">
<p>In this subection we list some <code>XP_OPTS</code> parameters that are useful when running Enonic XP in this image.</p>
</div>
<div class="sect4">
<h5 id="memory"><a class="link" href="#memory">Memory</a></h5>
<div class="paragraph">
<p>Like described in the <a href="#java-heap-memory">Heap memory</a> section, you should set the heap memory limits. If your machine has 4GB of memory, and you want to allocate 75% of that to heap memory, do that by adding to <code>XP_OPTS</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">-Xms3G -Xmx3G</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="heap_dumps_for_oome"><a class="link" href="#heap_dumps_for_oome">Heap dumps for OOME</a></h5>
<div class="paragraph">
<p>It is useful to make the JVM create a heap dump if the JVM throws an Out Of Memory Exception. Do that by adding to <code>XP_OPTS</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">-XX:-HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/enonic-xp/home/data/oom.hprof</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="remote_debugging"><a class="link" href="#remote_debugging">Remote debugging</a></h5>
<div class="paragraph">
<p>When tracking down particulary hard bugs, it can be useful to enable remote debugging. Do that by adding to <code>XP_OPTS</code>:</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
This should never be turned on by default and will make your system vulnerable to attacks.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5005</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="jvm_monitoring"><a class="link" href="#jvm_monitoring">JVM monitoring</a></h5>
<div class="paragraph">
<p>When debugging performance issues, it can be useful to attach a profiler to the JVM. Enable that option by adding to <code>XP_OPTS</code>:</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
This should never be turned on by default and will make your system vulnerable to attacks.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port=3000 -Dcom.sun.management.jmxremote.rmi.port=3000 -Dcom.sun.management.jmxremote.local.only=false -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false -Djava.rmi.server.hostname=0.0.0.0</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="exposed_ports"><a class="link" href="#exposed_ports">Exposed ports</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The image has 6 exposed ports:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is important to understand that even though the ports are exposed in the docker image, they will not be accessible unless you publish them with docker.
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">2609</dt>
<dd>
<p>Enonic XP metrics port</p>
</dd>
<dt class="hdlist1">4848</dt>
<dd>
<p>Enonic XP management port</p>
</dd>
<dt class="hdlist1">5701</dt>
<dd>
<p>Hazelcast communication port</p>
</dd>
<dt class="hdlist1">8080</dt>
<dd>
<p>Enonic XP server port</p>
</dd>
<dt class="hdlist1">9200</dt>
<dd>
<p>Elasticsearch API port</p>
</dd>
<dt class="hdlist1">9300</dt>
<dd>
<p>Elasticsearch communication port</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="useful_commands"><a class="link" href="#useful_commands">Useful commands</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="create_thread_dump"><a class="link" href="#create_thread_dump">Create thread dump</a></h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">docker exec $XP_CONTAINER bash -c 'jattach 1 threaddump &gt; $XP_HOME/data/threaddump.log'</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="create_heap_dump"><a class="link" href="#create_heap_dump">Create heap dump</a></h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">docker exec $XP_CONTAINER bash -c 'jattach 1 dumpheap $XP_HOME/data/heapdump.hprof'</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="verify_snapshot_age"><a class="link" href="#verify_snapshot_age">Verify snapshot age</a></h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">docker exec $XP_CONTAINER bash -c 'backup.sh'</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="full_example"><a class="link" href="#full_example">Full example</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>I this section we will create a single node deployment with <code>docker-compose</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Running commands this section requires you to have docker and docker-compose installed.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="setup"><a class="link" href="#setup">Setup</a></h3>
<div class="paragraph">
<p>First create a directory called <code>demo</code>. Lets get our base configuration, so inside the <code>demo</code> directory run the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">docker create --name=tmp enonic/xp:7.14.4-ubuntu
docker cp tmp:/enonic-xp/home/config config
docker rm tmp</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next we want to create a <code>setenv.sh</code> to install the snapshotter. Create a file called <code>setenv.sh</code> inside the <code>demo</code> directory.</p>
</div>
<div class="listingblock">
<div class="title">setenv.sh</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">#!/bin/sh

# Exit on failure
set -e

echo "Install bootstrap apps"
# Install snapshotter to create index snapshots
app.sh add https://repo.enonic.com/public/com/enonic/app/snapshotter/3.0.2/snapshotter-3.0.2.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we are almost ready. Lastly create a file called <code>docker-compose.yaml</code> inside the <code>demo</code> directory and paste the following into that file.</p>
</div>
<div class="listingblock">
<div class="title">docker-compose.yaml</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">version: '3'
services:
  xp:
    image: enonic/xp:7.14.4-ubuntu
    restart: always
    environment:
      # Assuming this computer has 4 GB of RAM, set JVM heap to 30% of available heap or 1230 MB. Also enable JVM OOME heap dump
      XP_OPTS: -Xms1230M -Xmx1230M -XX:-HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/enonic-xp/home/data/oom.hprof
    ports:
      - 8080:8080
    volumes:
      - blobstore:/enonic-xp/home/repo/blob
      - data:/enonic-xp/home/data
      - deploy:/enonic-xp/home/deploy
      - index:/enonic-xp/home/repo/index
      - snapshots:/enonic-xp/home/snapshots
      - ./config:/enonic-xp/home/config
      - ./setenv.sh:/enonic-xp/home/setenv.sh
volumes:
  blobstore:
  data:
  deploy:
  index:
  snapshots:</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="verifying"><a class="link" href="#verifying">Verifying</a></h3>
<div class="paragraph">
<p>Before starting your deployment, you should verify that your <code>demo</code> folder contains:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-files" data-lang="files">demo/
  config/
    com.enonic.xp.app.main.cfg
    com.enonic.xp.app.standardidprovider.cfg
    com.enonic.xp.audit.cfg
    com.enonic.xp.blobstore.cfg
    com.enonic.xp.blobstore.file.cfg
    com.enonic.xp.cluster.cfg
    com.enonic.xp.content.cfg
    com.enonic.xp.elasticsearch.cfg
    com.enonic.xp.extractor.cfg
    com.enonic.xp.hazelcast.cfg
    com.enonic.xp.mail.cfg
    com.enonic.xp.market.cfg
    com.enonic.xp.media.cfg
    com.enonic.xp.repo.cfg
    com.enonic.xp.server.deploy.cfg
    com.enonic.xp.server.shell.cfg
    com.enonic.xp.server.trace.cfg
    com.enonic.xp.server.udc.cfg
    com.enonic.xp.vacuum.cfg
    com.enonic.xp.web.dos.cfg
    com.enonic.xp.web.header.cfg
    com.enonic.xp.web.jetty.cfg
    com.enonic.xp.web.sessionstore.cfg
    com.enonic.xp.web.vhost.cfg
    logback.xml
    README.txt
    system.properties
  docker-compose.yaml
  setenv.sh</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="running"><a class="link" href="#running">Running</a></h3>
<div class="paragraph">
<p>To start up Enonic XP simply run this command in the <code>demo</code> directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">docker-compose up -d</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="verify_deployment"><a class="link" href="#verify_deployment">Verify deployment</a></h3>
<div class="paragraph">
<p>You can verify that everything is fine by looking at the logs. To do that run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">docker-compose logs -f</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also open up the admin UI at <a href="http://localhost:8080/admin/tool">http://localhost:8080/admin/tool</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="summary"><a class="link" href="#summary">Summary</a></h3>
<div class="paragraph">
<p>Now you have created a single node deployment that is easy to configure, backup and replicate.</p>
</div>
<div class="paragraph">
<p>You could create a git repository and push the <code>demo</code> folder to that repository to version control you deployment. That way if you want to replicate the deployment on another server, simply checkout the git repository on that server and run <code>docker-compose up -d</code> again.</p>
</div>
<div class="paragraph">
<p>You might be wondering where the data for Enonic XP will be stored. Since we defined volumes for it, it will be persisted where docker stores its volumes. That will vary depending on your operating system but on linux they are located at <code>/var/lib/docker/volumes</code>. You can query docker to figure out where you volumes are stored like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker volume ls --filter 'name=demo_*' --format '{{.Name}}:\t{{.Mountpoint}}'
demo_blobstore: /var/lib/docker/volumes/demo_blobstore/_data
demo_data:      /var/lib/docker/volumes/demo_data/_data
demo_deploy:    /var/lib/docker/volumes/demo_deploy/_data
demo_index:     /var/lib/docker/volumes/demo_index/_data
demo_snapshots: /var/lib/docker/volumes/demo_snapshots/_data</code></pre>
</div>
</div>
<div class="paragraph">
<p>To do backups you would simply back up the mountpoints for <code>demo_snapshots</code> and <code>demo_blobstore</code>. It is not as important to back up other directories.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="migration"><a class="link" href="#migration">Migrating from old image</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This image in general does not introduce any breaking changes for the regular user. There are some differences that can potentially break build pipelines that are based off the old image.</p>
</div>
<div class="sect2">
<h3 id="the_binary_wget_is_no_longer_present"><a class="link" href="#the_binary_wget_is_no_longer_present">The binary wget is no longer present</a></h3>
<div class="paragraph">
<p>The old image contained the <code>wget</code> binary. To keep the image size to a minimum and because <code>curl</code> is already present in the new image, <code>wget</code> is not installed in the new image.</p>
</div>
</div>
<div class="sect2">
<h3 id="directory_xp_roothome_org_no_longer_present"><a class="link" href="#directory_xp_roothome_org_no_longer_present">Directory $XP_ROOT/home.org no longer present</a></h3>
<div class="paragraph">
<p>The directory <code>$XP_ROOT/home.org</code> is now simply called <code>$XP_ROOT/home</code>. If you are modifying that directory in your build steps you will have make the appropriate changes.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="image_source_code"><a class="link" href="#image_source_code">Image source code</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The source code for the <code>Dockerfile</code> and all related scripts is open source and can be viewed <a href="https://github.com/enonic/docker-xp7">here</a>.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2025-02-06 15:16:07 UTC
</div>
</div>
</body>
</html>